<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>redux原理03</title>
</head>
<body>
  <div>

    <button onclick="store.dispatch({type:'subtraction',n:2})">-</button>
    <span id="countDisplay">10</span>
    <button onclick="store.dispatch({type:'addition',n:3})"> + </button>

  </div>

  <script src="https://cdn.bootcss.com/redux/4.0.5/redux.js"></script>
  <script>
    const countDisplay = document.querySelector('#countDisplay')
    const countState = {
      count:5
    }
    // const renderCount = (state) =>{
    //   countDisplay.innerHTML = state.count
    // }

    // const changeState = (state,action) => {
    //   switch(action.type) {
    //     case 'addition':
    //       state.count = state.count  + action.n
    //       break;
    //     case 'subtraction':
    //       state.count = state.count - action.n
    //       break;
    //     default:
    //       break;
    //   }
    // }

    const changeState = (state,action) => {
      if(!state){
        return countState
      }
      switch(action.type) {
        case 'addition':
          return{
            ...state,
            count:state.count+action.n
          }
        case 'subtraction':
          return{
              ...state,
              count:state.count - action.n
            }
        default:
          return state
      }
    }

  //  const createStore = (state,changeState) => {
  //  const createStore = (changeState) => {
  // const createStore = (  ) => {
  //   let state = null
  //   const getState = () => state 
  //   const listeners = []
  //   const subscribe = (listener) => listeners.push(listener)
  //   const dispatch = (action) =>{
  //     state = changeState(state,action)
  //     console.log(state)
  //     listeners.forEach(listener => listener())
  //   }
  //   console.log(dispatch)
  //   dispatch({})
  //   return {
  //     getState,
  //     subscribe,
  //     dispatch
  //   }      
  //  }


  //  const store = createStore(countState,changeState)
  //  const store = createStore(changeState)
   const store = Redux.createStore(changeState)
  //  console.log(store)
  //  console.log(store.getState)
  //  console.log(store.getState())

   const renderCount =() => {
    countDisplay.innerHTML = store.getState().count
   }

   renderCount()

   store.subscribe(renderCount)



  </script>
</body>  
</html>